{layout name='example' /}
{if $Think.session.cdo.add}
<fieldset class="fieldsetclass">
    <legend>操作</legend>
    <button class="item-update layui-btn add-fee"> {$Think.session.cdo.add} </button>
</fieldset>
{/if}
<table class="layui-table">
    <thead>
    <tr>
        <th>ID</th>
        <th>名称</th>
        <th>在用商铺</th>
        <th>操作</th>
    </tr>
    </thead>
    <tbody>
    {foreach $fees as $fee}
    <tr>
        <td>{$fee['id']}</td>
        <td>{$fee['name']}</td>
        <td>
            {if $fee['shops']}
                {foreach $fee['shops'] as $shop}
                    {$shop['title']}&nbsp&nbsp&nbsp&nbsp&nbsp
                {/foreach}
            {else}
                无
            {/if}
        </td>
        <td>
            {if $Think.session.cdo.edit}
            <button class="layui-btn layui-btn-normal layui-btn-small edit-fee" data-id="{$fee['id']}">{$Think.session.cdo.edit}</button>
            {/if}
            {if $Think.session.cdo.delete}
            <button class="layui-btn layui-btn-danger layui-btn-small delete-fee" data-id="{$fee['id']}">{$Think.session.cdo.delete}</button>
            {/if}
        </td>
    </tr>
    {/foreach}
    </tbody>
</table>
<script>
    layui.use(['layer'],function(){
            var layer = layui.layer;
            //　添加按钮
            $(".add-fee").click(function(){
                layer.open({
                    type: 2,
                    title: '添加策略',
                    maxmin: true,
                    area : ['550px' , '400px'],
                    content: '{$opt}?do=add',
                });
            });
            //　编辑按钮
            $(".edit-fee").click(function(){
                layer.open({
                    type: 2,
                    title: '编辑策略',
                    maxmin: true,
                    area : ['550px' , '400px'],
                    content: '{$opt}?do=edit&fee_strategy_id='+$(this).data('id'),
                });
            });
            // 删除按钮
            $(".delete-fee").click(function(){
                $.ajax({
                    url: '{$opt}?do=delete&fee_strategy_id='+$(this).data('id'),
                    data: {},
                    success: function(e){
                        if(e.code == 0) {
                            layer.msg(e.msg, {icon: 1}, function(){
                                window.location.reload();
                            });
                        } else {
                            layer.msg(e.msg, {icon: 2, time: 3000});
                        }
                    }
                });
            });
        });
</script>