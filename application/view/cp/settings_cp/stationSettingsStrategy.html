{layout name='example' /}
{if $Think.session.cdo.add}
<fieldset class="fieldsetclass">
	<legend>操作</legend>
	<button class="item-update layui-btn" id="add-strategy"> {$Think.session.cdo.add} </button>
</fieldset>
{/if}
<table class="layui-table">
	<thead>
	<tr>
		<th width="10%">ID</th>
		<th width="20%">策略名称</th>
		<th>在用站点</th>
		<th>操作</th>
	</tr>
	</thead>
	<tbody>
		{foreach $settings as $setting}
		<tr>
			<td>{$setting['id']}</td>
			<td>{$setting['name']}</td>
			<td>
				{if $setting['stations']}
					{foreach $setting['stations'] as $station}
						{$station['title']}&nbsp&nbsp&nbsp&nbsp&nbsp
					{/foreach}
				{else}
				无
				{/if}
			</td>
			<td>
				{if $Think.session.cdo.edit}
				<button class="edit_role layui-btn layui-btn-normal layui-btn-small edit-strategy" data-id="{$setting['id']}">{$Think.session.cdo.edit}</button>
				{/if}
				{if $Think.session.cdo.delete}
				<button class="edit_role layui-btn layui-btn-danger layui-btn-small delete-strategy" data-id="{$setting['id']}">{$Think.session.cdo.delete}</button>
				{/if}
			</td>
		</tr>
		{/foreach}
	</tbody>
</table>
{$pagehtm}
<script>
	layui.use('layer', function(){
            var layer = layui.layer;
            //　添加按钮
            $("#add-strategy").click(function(){
                layer.open({
                    type: 2,
                    title: '添加策略',
                    maxmin: true,
                    area : ['500px' , '550px'],
                    content: '{$opt}?do=add'
                });
            });
            //　编辑按钮
            $(".edit-strategy").click(function(){
                layer.open({
                    type: 2,
                    title: '编辑策略',
                    maxmin: true,
                    area : ['500px' , '550px'],
                    content: '{$opt}?do=edit&station_strategy_id='+$(this).data('id')
                });
            });

            $('.delete-strategy').click(function(){
                $.ajax({
                    url: '{$opt}?do=delete&station_strategy_id='+$(this).data('id'),
                    data: {},
                    success: function(e){
                        if(e.code == 0) {
                            layer.msg(e.msg, {icon: 1}, function(){
                                window.location.reload();
                            });
                        } else {
                            layer.msg(e.msg, {icon: 2, time: 3000});
                        }
                    }
                });
			})
        });
</script>
